!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=18)}([function(e,t,r){const n=r(19),a=r(20);n.extend(a),e.exports=n},function(e,t,r){"use strict";(function(t){var n=r(9),a=r(8),o=r(21),s=a.basename(t),i=r(22).production,c={};if(process.env.DATABASE_URL)var u=r(23).connect(o);else u=new o(i.database,i.username,i.password,i);n.readdirSync("./db/models").filter(e=>0!==e.indexOf(".")&&e!==s&&".js"===e.slice(-3)).forEach(e=>{var t=u.import(a.resolve(a.join("./db/models",e)));c[t.name]=t}),Object.keys(c).forEach(e=>{c[e].associate&&c[e].associate(c)}),c.sequelize=u,c.Sequelize=o,e.exports=c}).call(this,"/index.js")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("graphql-tools-types")},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("axios")},function(e,t,r){const n=r(6),a=r(5),o=r(3),{last:s}=r(2),{Price:i,Stock:c,Sequelize:u}=r(1),l=r(0);o.config();const p=`https://www.alphavantage.co/query?function=BATCH_STOCK_QUOTES&symbols=:symbols&interval=5min&apikey=${process.env.ALPHA_VANTAGE_API}`;function d(e,t){return e.isSame(t,"year")&&e.isSame(t,"month")&&e.isSame(t,"date")}e.exports={getStocks:async function(e){await async function(e){const t=e.subtract(60,"day").format("YYYY-MM-DD");await i.destroy({where:{x:{[u.Op.lt]:t}}})}(e);const t=await c.findAll({raw:!0});if(t.length>0){const r=await i.findAll({order:["symbol","x"],raw:!0}),o=t.map(e=>e.id);let c;if(d(e,l.utc(s(r).x).add(1,"day")))c=r;else{const t=await async function(e,t){const r=e.join(","),o=p.replace(":symbols",r),{data:s}=await n.get(o);console.log(o);const c=s["Stock Quotes"].map(e=>{const r=e["1. symbol"],n=e["2. price"],{0:o}=e["4. timestamp"].split(" ");if(d(t,l.utc(o))){return{id:a(),symbol:r,x:t.toDate(),y:n}}}).filter(e=>e);return c.length?i.bulkCreate(c,{return:!0}):[]}(o,e);c=r.concat(t)}return{stocks:t,prices:c}}return{stocks:[],prices:[]}},isSame:d}},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("apollo-server-express")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("graphql-tools")},function(e,t){e.exports=require("rollbar")},function(e,t,r){"use strict";var n=r(4),a=r.n(n),o=r(5),s=r.n(o),i=r(6),c=r.n(i),u=r(3),l=r.n(u),p=r(2),d=r(0),f=r.n(d),y=r(1),m=r(7);l.a.config();const b=`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=:symbol&apikey=${process.env.ALPHA_VANTAGE_API}`,x=`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=:symbol&apikey=${process.env.ALPHA_VANTAGE_API}`;function S(e,t,r){e.splice(t,0,r)}t.a={UUID:a.a.UUID({name:"UUID",storage:"string"}),JSON:a.a.JSON({name:"JSON"}),Date:a.a.Date({name:"Date"}),Void:a.a.Void({name:"Void"}),Mutation:{async createStock(e,{id:t}){const r=b.replace(":symbol",t),{data:n}=await c.a.get(r),a=n["Time Series (Daily)"];if(Object(p.isEmpty)(a))throw new Error("Invalid symbol");const o=x.replace(":symbol",t),{data:i}=await c.a.get(o);let u="Unavailable";if(i.bestMatches.length){const{0:e}=i.bestMatches;u=e["2. name"]}return await y.sequelize.transaction(async e=>{if((await y.Stock.findCreateFind({where:{id:t},defaults:{id:t,company:u},raw:!0},{transaction:e}))[1]){const r=f.a.utc(f()().format("YYYY-MM-DD")),n=r.subtract(61,"day"),o=Object.keys(a).filter(e=>{const t=f.a.utc(e);return function(e,t){return e.isAfter(t,"year")||e.isAfter(t,"month")||e.isAfter(t,"date")}(t,n)||Object(m.isSame)(t,n)}).map(e=>({id:s()(),symbol:t,x:f.a.utc(e).toDate(),y:Object(p.round)(a[e]["4. close"],2)}));!function(e,t){let r=e,n={...t[0]};for(let e=0;e<60;e+=1){const a=t[e];a&&Object(m.isSame)(f.a.utc(a.x),r)||(n.id=s()(),n.x=r.toDate(),S(t,e,n)),n={...t[e]},r=r.subtract(1,"day")}}(r,o),await y.Price.bulkCreate(o,{transaction:e});const{y:i}=o[0];return{id:t,company:u,price:i,chart:o.map(({xVal:e,yVal:t})=>({x:f.a.utc(e),y:t}))}}throw new Error("Symbol already exists")})},deleteStock:async(e,{id:t})=>(await y.sequelize.transaction(async e=>{await y.Price.destroy({where:{symbol:t}},{transaction:e}),await y.Stock.destroy({where:{id:t}},{transaction:e})}),t)},Query:{async stocks(){const e=f.a.utc(f()().format("YYYY-MM-DD")),{stocks:t,prices:r}=await Object(m.getStocks)(e),n=Object(p.groupBy)(r,e=>e.symbol);return t.map(({id:e,company:t})=>{const{0:{y:r}}=n[e];return{id:e,company:t,price:r,chart:n[e].map(({x:e,y:t})=>({x:f.a.utc(e).add(1,"day").toDate(),y:Object(p.round)(t,2)}))}}).filter(e=>e)}}}},function(e,t,r){"use strict";r.r(t),function(e){var t=r(10),n=r.n(t),a=r(11),o=r.n(a),s=r(13),i=r.n(s),c=r(8),u=r.n(c),l=r(14),p=r(12),d=r(9),f=r.n(d),y=r(15),m=r(3),b=r.n(m),x=r(16),S=r.n(x),w=r(17);b.a.config();const h=n()(),v=process.env.PORT||3e3;h.use("/",n.a.static("public")),h.use(i()()),h.use(o.a.urlencoded({extended:!1})),h.use(o.a.json());const g=f.a.readFileSync("./graphql/schema.gql","utf8"),q=Object(y.makeExecutableSchema)({typeDefs:g,resolvers:w.a});h.use("/graphql",Object(p.graphqlExpress)(()=>({schema:q})));{const e=new S.a({accessToken:process.env.ROLLBAR_ACCESS_TOKEN,captureUncaught:!0,captureUnhandledRejections:!0});h.use(e.errorHandler())}h.get("*",(t,r)=>{r.sendFile(u.a.resolve(e,"public","index.html"))}),Object(l.createServer)(h).listen(v,()=>{console.log("Server Started at port 3000")})}.call(this,"/")},function(e,t){e.exports=require("dayjs")},function(e,t){e.exports=require("dayjs/plugin/utc")},function(e,t){e.exports=require("sequelize")},function(e){e.exports=JSON.parse('{"development":{"username":"username","password":"password","database":"database","storage":"./dev.sqlite3","dialect":"sqlite"},"production":{"use_env_variable":"DATABASE_URL","dialect":"postgres"}}')},function(e,t){e.exports=require("sequelize-heroku")}]);